# Fix2Fit: Crash-avoiding Program Repair

Fix2Fit is an integrated approach for detecting and discarding crashing patches. Fix2Fit fuses test and patch generation into a single process, in which patches are generated with the objective of passing existing tests, and new tests are generated with the objective of filtering out over-fitted patches by distinguishing candidate patches in terms of behavior. The oracle to discard patch candidates is determined by crash-freedom including traditional crash and security vulnerability detected by Sanitizer.

This software is built on top of [OSS-Fuzz](https://github.com/google/oss-fuzz)(please refer `README_OSSFUZZ.md` for the renamed original OSS-Fuzz `README.md`). As with OSS-Fuzz, it mainly fixes the bugs/vulnerabilities detected by fuzzing techniques. Fix2Fit takes inputs the buggy program and a failing test case, generates a set of plausible patches, which fix the bug and does not introduce crash.

### Requirement
1. Python 2.7
2. Docker

### Installation
1. Get Fix2Fit source:
```
git clone https://github.com/gaoxiang9430/Fix2Fit.git
git submodule update --init --recursive
```

2. Build OSS-fuzz base images
```
cd Fix2Fit
./infra/base-images/all.sh
```

3. Build Fix2Fit image
```
docker build -t gaoxiang9430/fix2fit .
```

### Runing Example
1. prepare docker file for subjects
```
cd projects
./prepare_docker.sh [SUBJECT]
**SUBJECT** is the subject name, such as ffmpeg
```

2. Run 
```
./scripts/run.sh [SUBJECT]  [SUBJECT_ID]  [CPU_ID] 
**SUBJECT_ID** is the issue id that is assigned by OSS-Fuzz issue tracker (e.g. [1345](https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=1345))
**CPU_ID** is the CPU id on which you execute this process
```

Here we mention several important files:

* `Makefile`: This is used to execute all of the automated repair
  experiments in parallel. For example, do
  ```
  make -j 55
  ```
  To execute all of the experiments, each on a different project (buggy
  software) in parallel using at most 55 cores.
  ```
  make -j 55 ffmpeg
  ```
  will only execute the projects for the FFmpeg software, in parallel using at most 55 cores.
  ```
  make ffmpeg_1298.log
  ```
  will only execute the project for the issue 1298 of the FFmpeg
  software. Please try not to edit the `Makefile` as it is automatically
  generated by `build_makefile.sh`.

* `scripts/run.sh`: The actual execution is done by this script. `Makefile` is actually just a parallelization wrapper for it. In case you want to use it directly, here is some examples:
  ```
  ./scripts/run.sh
  ```
  will run all the projects sequentially.
  ```
  ./scripts/run.sh wireshark
  ```
  will run only the wireshark projects sequentially.
  ```
  ./scripts/run.sh wireshark 3372
  ```
  will run only the project 3372 of wireshark.

The repository does not contain the source code of the buggy code subjects: The code will be automatically downloaded and the right commit hash will be checked out.

